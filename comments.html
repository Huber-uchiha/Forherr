<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Comments Page</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f4f4f9; }
    h1 { text-align: center; }
    form { max-width: 500px; margin: 20px auto; display: flex; flex-direction: column; gap: 10px; }
    input, textarea, button { padding: 10px; font-size: 1rem; border-radius: 5px; border: 1px solid #ccc; }
    button { background: #007bff; color: #fff; cursor: pointer; border: none; }
    button:hover { background: #0056b3; }
    .comments { max-width: 600px; margin: 20px auto; }
    .comment { background: white; padding: 10px; margin-bottom: 10px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .meta { font-size: 0.85rem; color: gray; margin-bottom: 5px; }
    .delete { margin-top: 5px; background: red; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; }
  </style>
</head>
<body>
  <h1>ðŸ’¬ Comment Section</h1>

  <!-- Comment form -->
  <form id="commentForm">
    <input type="text" id="nameInput" placeholder="Your Name" />
    <textarea id="textInput" placeholder="Write your comment..." required></textarea>
    <button type="submit">Post Comment</button>
  </form>

  <!-- Comments list -->
  <div class="comments" id="commentsList"></div>

  <!-- Back button -->
  <div style="text-align:center; margin-top:20px;">
    <button onclick="window.location.href='index.html'">â¬… Back to Home</button>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    // Import Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getDatabase, ref, push, set, onChildAdded, remove } 
      from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

    // âœ… Your Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyBTcZhqWNtQfzwmVSLUj-UVrNSmfso8M-E",
      authDomain: "comment-42a8d.firebaseapp.com",
      databaseURL: "https://comment-42a8d-default-rtdb.firebaseio.com",
      projectId: "comment-42a8d",
      storageBucket: "comment-42a8d.firebasestorage.app",
      messagingSenderId: "907945120076",
      appId: "1:907945120076:web:eb18596749736cabe2bfe9",
      measurementId: "G-CYY165F7ZN"
    };

    // Init Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Elements
    const form = document.getElementById("commentForm");
    const nameInput = document.getElementById("nameInput");
    const textInput = document.getElementById("textInput");
    const commentsList = document.getElementById("commentsList");

    // Submit new comment
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const name = nameInput.value.trim() || "Anonymous";
      const text = textInput.value.trim();
      if (!text) return alert("Write something!");

      const commentRef = push(ref(db, "comments")); // auto id
      await set(commentRef, {
        name,
        text,
        createdAt: Date.now()
      });

      textInput.value = "";
    });

    // Show comments in realtime
    const commentsRef = ref(db, "comments");
    onChildAdded(commentsRef, (snapshot) => {
      const data = snapshot.val();
      const id = snapshot.key;

      const wrapper = document.createElement("div");
      wrapper.className = "comment";

      const meta = document.createElement("div");
      meta.className = "meta";
      meta.textContent = `${data.name} â€¢ ${new Date(data.createdAt).toLocaleString()}`;

      const text = document.createElement("div");
      text.textContent = data.text;

      const delBtn = document.createElement("button");
      delBtn.className = "delete";
      delBtn.textContent = "Delete";
      delBtn.onclick = () => remove(ref(db, "comments/" + id));

      wrapper.appendChild(meta);
      wrapper.appendChild(text);
      wrapper.appendChild(delBtn);

      commentsList.appendChild(wrapper);
    });
  </script>
</body>
</html>
